RewriteEngine on

###
# Important note: Do not use 3xx redirects because the app is located behind a reverse proxy
###

### Legacy

RewriteRule ^(.*)confirmations/([A-z0-9\-]{36})/file([^/]*)/?$ 		$1/confirmations/view.php?id=$2&file=true$3 
RewriteRule ^(.*)confirmations/([A-z0-9\-]{36})/edit/?$ 			$1/confirmations/edit.php?id=$2
RewriteRule ^(.*)confirmations/([A-z0-9\-]{36})/print/?$ 			$1/confirmations/view.php?id=$2&print=true
RewriteRule ^(.*)guardian/events/([A-z0-9\-]{36})/?$ 				$1/guardian/events/view.php?id=$2
RewriteRule ^(.*)guardian/reports/([A-z0-9\-]{36})/?$ 				$1/guardian/reports/view.php?id=$2
RewriteRule ^(.*)inspection/([A-z0-9\-]{36})/file([^/]+)/?$ 		$1/inspection/view.php?inspection=$2&file=true$3


### Specific rules

# Confirmations and DataChangeRequests

RewriteRule ^(.*)process/accepted/?$ 	$1/process.php?accepted
RewriteRule ^(.*)process/declined/?$ 	$1/process.php?declined
RewriteRule ^(.*)process/request/?$ 	$1/process.php?request
RewriteRule ^(.*)process/done/?$ 		$1/process.php?done
RewriteRule ^(.*)accepted/?$			$1/overview.php?accepted
RewriteRule ^(.*)declined/?$			$1/overview.php?declined
RewriteRule ^(.*)done/?$				$1/overview.php?done

# Hydrants and Inspections

RewriteRule ^(.*)evaluation/([^/]+)?$ 	$1/evaluation.php?year=$2
RewriteRule ^(.*)street/([^/]+)/?$ 		$1/street_view.php?street=$2
RewriteRule ^(.*)engine/([^/]+)/?$ 		$1/engine_view.php?engine=$2
RewriteRule ^(.*)inspected/?$ 			$1/inspected_view.php
RewriteRule ^(.*)map/([^/]+)/?$ 		$1/maps.php?hydrant=$2

# Events and Reports

RewriteRule ^(.*)past/?$ 									$1/overview.php?past
RewriteRule ^(.*)calender/([^/]+)?$ 						$1/calender.php?id=$2
RewriteRule ^(.*)events/([^/]+)/assign/?([^/]+)/?$			$1/events/assign.php?id=$2&staffid=$3
RewriteRule ^(.*)events/([^/]+)/subscribe/?([^/]+)/?$ 		$1/events/subscribe.php?id=$2&staffid=$3
RewriteRule ^(.*)events/([^/]+)/acknowledge/?([^/]+)/?$ 	$1/events/details.php?id=$2&acknowledge=$3
RewriteRule ^(.*)reports/new/([^/]+)/?$ 					$1/reports/edit.php?event=$2
RewriteRule ^(.*)templates/([^/]+)/?$ 						$1/templates.php?eventtype=$2

# Users etc.

RewriteRule ^(.*)reset/([^.]+)/?$ 						$1/reset.php?token=$2
RewriteRule ^(.*)register/?$ 							$1/edit.php
RewriteRule ^(.*)admin/([^/]+)/?$ 						$1/admin.php?id=$2
RewriteRule ^(.*)users/([^/]+)/privilege/([^/]+)/?$ 	$1/users/privilege.php?user=$2&engine=$3
RewriteRule ^(.*)users/([^/]+)/privilege/?$ 			$1/users/privilege.php?user=$2
RewriteRule ^(.*)users/filter/([^.]+)/?$ 				$1/users/overview.php?filter=$2 
RewriteRule ^(.*)setView/([^.]+)/?$						$1/setView.php?engine=$2

# Administrative

RewriteRule ^(.*)logbook/page/([^.]+)/?$	$1/logbook.php?page=$2
RewriteRule ^(.*)maillog/page/([^.]+)/?$	$1/maillog.php?page=$2

# Ajax

RewriteRule ^(.*)ajax/hy/([^.]+)/field/([^.]+)/?$ 	$1/ajax/hy_request.php?fid=$2&fieldid=$3 
RewriteRule ^(.*)ajax/templates/([^/]+)/?$ 			$1/ajax/staff_template.php?uuid=$2
RewriteRule ^(.*)ajax/user/([^/]+)/?$				$1/ajax/user.php?uuid=$2
RewriteRule ^(.*)ajax/privileges/([^/]+)/?$			$1/ajax/privileges.php?uuid=$2


### Generic Rules

RewriteRule ^(.*)view/([^/]+)/?$ 				$1/view.php?id=$2
RewriteRule ^(.*)view/([^/]+)/print?$ 			$1/view.php?id=$2&print=true
RewriteRule ^(.*)view/([^/]+)/file([^/]+)?$ 	$1/view.php?id=$2&file=true$3

RewriteRule ^(.*)new/?$					$1/edit.php
RewriteRule ^(.*)edit/([^/]+)/?$ 		$1/edit.php?id=$2


#If request does not end with .php -> add .php
RewriteCond %{THE_REQUEST} "!^[^ ]* .*?\.php[? ].*$"
RewriteCond %{REQUEST_FILENAME}\.php -f
RewriteRule ^([^.?]+)$ %{REQUEST_URI}.php [L]

# Add trailing slash if file is not existing to route to subfolder
RewriteCond %{REQUEST_FILENAME} -d
RewriteCond %{REQUEST_URI} !(.*)/$
RewriteRule ^(.*)$ $1/ [L]

#If request ends with .php -> 400
RewriteCond %{THE_REQUEST} "^[^ ]* .*?\.php[? ].*$"
RewriteRule .* - [L,R=400]